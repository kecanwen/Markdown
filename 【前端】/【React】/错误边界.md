## React 之 错误边界（Error Boundaries）

### 一、定义

> 错误边界是**一种 React 组件**，这种组件可以捕获发生在其子组件树任何位置的 JavaScript 错误。
>
> 并有能力阻止错误继续传播，并打印这些错误，同时展示降级 UI，而并不会渲染那些发生崩溃的子组件树
>
> 错误边界可以捕获发生在整个子组件树的渲染期间、生命周期方法以及构造函数中的错误
>

**部分 UI 的 JavaScript 错误不应该导致整个应用崩溃 **

如：jsx的html结构中显示对象

### 二、细节：

1. 错误边界组件必须是**类组件** 因为在类组件中才能使用生命周期函数

2. 错误边界组件**只能处理子组件的错误**

3. 错误边界无法捕获以下场景中产生的错误：

   - ​		事件处理
   
   
      - ​		异步代码（例如 setTimeout 或 requestAnimationFrame 回调函数）
   
   
      - ​		服务端渲染
   
   
      - ​		它自身抛出来的错误（并非它的子组件）
   

在 React 中，函数式组件可以实现错误边界。错误边界是一种用于捕获并处理组件树中 JavaScript 错误的机制，以防止整个应用程序崩溃。

在函数式组件中实现错误边界的步骤如下：

1. 创建一个错误边界组件：首先，你需要创建一个函数式组件作为错误边界组件。这个组件将充当错误边界的容器。

```javascript
function ErrorBoundary({ children }) {
  const [hasError, setHasError] = useState(false);

  if (hasError) {
    return <div>Something went wrong.</div>;
  }

  return children;
}
```

2. 使用错误边界组件包裹其他组件：将需要进行错误边界处理的组件包裹在错误边界组件中。

```javascript
function App() {
  return (
    <div>
      <h1>My App</h1>
      <ErrorBoundary>
        <ComponentWithError />
      </ErrorBoundary>
    </div>
  );
}
```

3. 在错误边界组件中使用 componentDidCatch 方法：在错误边界组件中，你可以使用 `componentDidCatch` 生命周期方法（或者在函数式组件中使用 `useEffect`）来捕获和处理错误。

```javascript
function ErrorBoundary({ children }) {
  const [hasError, setHasError] = useState(false);

  useEffect(() => {
    const handleError = () => {
      setHasError(true);
    };

    // 捕获错误
    window.addEventListener('error', handleError);

    return () => {
      // 清理事件监听器
      window.removeEventListener('error', handleError);
    };
  }, []);

  if (hasError) {
    return <div>Something went wrong.</div>;
  }

  return children;
}
```

通过以上步骤，你可以在函数式组件中实现错误边界。当被包裹的组件抛出错误时，错误将被捕获并由错误边界组件进行处理。在上面的示例中，如果 `ComponentWithError` 抛出了一个错误，那么错误边界组件将显示 "Something went wrong."。

需要注意的是，错误边界只能捕获其子组件树中的错误，并不能捕获自身或其他同级组件的错误。此外，在开发模式下，错误仍然会被记录到控制台中，但不会导致整个应用程序崩溃。

请注意，错误边界功能要求 React 版本为16及以上。
